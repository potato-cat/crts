#!/bin/bash

set -ex

topdir=$PWD

# Do not run this if we already did.
[ -f $topdir/src/SUCCESS ] && exit 0

rm -rf src

tar -xzmf libwebsockets.tar.gz

mv warmcat-libwebsockets-* src

cd src

mkdir BUILD

cd BUILD


cmake .. -G"Unix Makefiles"\
 -DCMAKE_INSTALL_PREFIX:PATH="${LIBWEBSOCKETS_PREFIX}"


make VERBOSE=1 -j $(nproc || echo '3')
