#!/bin/bash

# This script sets up the software for a typical development
# configuration.  You are not necessarily encouraged to use this, but
# copying it and making your own local version of it is encouraged.


# We let the make files have a prefix (or PREFIX) which is an encapsulated
# installation directory, where all files that get installed are installed
# to.  There will be sub-directories created in the prefix directory like
# bin/ lib/ include/ share/ and etc/ ... (pun intended).
#
# This "prefix" idea has a history and many different manifestations.
#
#   references:
#
# https://www.gnu.org/prep/standards/standards.html#Directory-Variables
# http://www.freetds.org/userguide/config.htm
# https://askubuntu.com/questions/891835/what-does-prefix-do-exactly-when-used-in-configure

# We try to limit all user configuration options to the one file
# ./config.make which is a GNU make file that is accessed by most other
# make files (named GNUmakefile).  If config.make is changed after files
# are generated you want to run "make clean && make" to rebuild the
# generated files that depend on these make configuration variables.


if [ "$(whoami)" = lance ] ; then
    root=/usr/local/encap
else
    root=${HOME}/installed
fi

# Where to install UHD and GUNradio
UHD_PREFIX=$root/uhd
GNURADIO_PREFIX=$root/gnuradio

# CRTS prefix
PREFIX=$root/crts


set -e

# Get in this directory where this file is:
dir="$(dirname ${BASH_SOURCE[0]})"
[ -n "$dir" ] || exit 1
cd "$dir"


[ ! -f quickbuild.make ] && ./bootstrap

cat > config.make << EOF
# This is a generated file



# compiler options
CFLAGS := -g -Wall -Werror
CXXFLAGS := \$(CFLAGS)

# Comment this out to not add extra code to debug the buffering.
CPPFLAGS := -DBUFFER_DEBUG


# select 1 of the next two lines, effects include/crts/debug.h
DEBUG := \#define DEBUG
#DEBUG := // DEBUG is not defined


# select 1 of the next few lines, effects include/crts/debug.h
#SPEW_LEVEL := \#define SPEW_LEVEL_ERROR
#SPEW_LEVEL := \#define SPEW_LEVEL_WARN
#SPEW_LEVEL := \#define SPEW_LEVEL_NOTICE
#SPEW_LEVEL := \#define SPEW_LEVEL_INFO
SPEW_LEVEL  := \#define SPEW_LEVEL_DEBUG

# CRTS installation prefix directory:
PREFIX := ${PREFIX}


UHD_PREFIX := ${UHD_PREFIX}
GNURADIO_PREFIX := ${GNURADIO_PREFIX}

EOF

echo
echo

cat config.make
echo
