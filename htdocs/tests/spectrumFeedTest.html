<!DOCTYPE html>
<html lang=en>
<head>
    <meta charset="utf-8"></meta>
    <link rel=stylesheet href="../css/main.css"></link>
    <link rel=stylesheet href="../x3dom/x3dom.css"></link>
    <link rel=stylesheet href="../css/functionTest.css"></link>
    <script src="../x3dom/x3dom.js"></script>
    <script src="../js/3DSpectrumDisplay.js"></script>
    <script src="../js/crts.js"></script>
    <script src="../js/functionTest.js"></script>

    <style>
        body {
            background-color: #999;
        }
        .floater {
            float: left;
            margin: 10px;
        }
        .clear {
            clear: both;
        }
        x3d {
            width: 100%;
            height: 100%;
        }
    </style>

    <script>

var display = null;


// parameters that get passed to API functions.
//
// The value may be anything that is JSON.stringify()-able.
//
var parameters = {

    hosts: {

        description: "array of hosts as strings",
        value: [ "" ],
        units: ""
    },

    USRPSelection: {

        // This object is special in that it does not have an input.
        // We will add a <select> in place of an <input>.
        // container will be where we put the <select>.

        description: "pick a USRP and host",
        value: "",
        units: "",
        container: null
    },

    spectrumKey: {

        description: "spectrum key", // select description
        value: "",
        units: "",
        readonly: true
    },

    host: {

        description: "USRP host computer",
        value: "",
        units: "",
        readonly: true
    },

    uhd_args: {

        description: "arguments passed to UHD object",
        value: "",
        units: "",
        readonly: true
    },
      

    freq: {

        description: "freq",
        value: 915.0,
        units: "MHz"
    },

    bandwidth: {

        description: "bandwidth",
        value: 2.0,
        units: "MHz"
    },

    bins: {

        description: "number of bins",
        value: 6,
        units: "in FFT sample"
    },

    steps: {

        description: "number of steps",
        value: 3,
        units: "for 3D display"
    },

    updateRate: {

        description: "spectrum update rate",
        value: 1.0,
        units: "Hz"
    }
};


function UpdateUSRPSelect(select) {

    USRPs_getList(parameters.hosts.value/*array of strings of hostnames*/,
        function(hostUSRPs) {

        dspew('GOT USRPS =' + JSON.stringify(hostUSRPs));

        Object.keys(hostUSRPs).forEach(function(host) {
            // host
            hostUSRPs[host].forEach(function(usrp) {
                var option = document.createElement('OPTION');
                option.text = ' type: ' + usrp.type +
                    ' | host="' + host + '"' +
                    ' | addr=' + usrp.addr +
                    ' | Serial # ' + usrp.serial/*text*/;
                option.Value = {
                    spectrumKey: usrp.serial,
                    host: host,
                    uhd_args: 'addr=' + usrp.addr
                };

                select.appendChild(option);
            });
        });

        select.onchange = function() {

            var value = this.options[this.selectedIndex].Value;

            parameters.spectrumKey.input.value = value.spectrumKey;
            parameters.host.input.value = value.host;
            parameters.uhd_args.input.value = value.uhd_args;

            spew('--------------------- selected ' + value.spectrumKey);

        };
    });




}


onload = function() {

    FunctionTest_init(parameters, GetElementById('inputTable'));

    var select = document.createElement('select');
    UpdateUSRPSelect(select);
    parameters.USRPSelection.container.appendChild(select);
};



    </script>

    <title>Spectrum Test</title>
</head>
<body>

    <h1>CRTS USRP Spectrum Feed Test</h1>

    <div class=floater>

        <div id=x3dHolder style="background-color: #aaa; width: 800px; height:500px;">
        </div>

        <p>press <b>Page Up</b> and <b>Page Down</b> to jump through
            five different view positions</p>
    </div>



    <div class=floater>

        <table id=inputTable>
        </table>

        <ul>
            <li><span class=functionButton>UpdateSelectWithUsrps(hosts)</span></li>
            <li><span class=functionButton>SpectrumFeed_create(spectrumKey,host,uhd_args)</span></li>
        </ul>

 
    </div>


    <footer class=clear>
        Return to <a href="index.html">CRTS Development Tests index</a>
    </footer>

</body>
</html>
